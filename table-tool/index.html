<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="UTF-8">
  <link rel="stylesheet" href="http://cdn.webix.com/edge/webix.css" type="text/css"> 
  <script src="http://cdn.webix.com/edge/webix.js" type="text/javascript"></script>
  <script language="javascript" src="lz-string.js"></script>
  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      const urls = window.location.toString().split("#");
      console.log('data', urls[1]);
      const dataAll = urls[1] ? JSON.parse(LZString.decompressFromEncodedURIComponent(urls[1])) : {title: 'No Title'};
      const title = dataAll['title'];
      const data = dataAll['data'] ? dataAll['data'] : [];
      const columns = [
        { id: 'question', header: ["问题",{content:"textFilter"}], fillspace: 2, editor:"text" },
        { id: 'poster', header: ["提出人",{content:"selectFilter"}], fillspace: 1, editor:"text", sort:"string" },
        { id: 'status', header: ["状态",{content:"selectFilter"}], fillspace: 1, editor:"select", options: ['1:待处理', '2:设计中，待开发', '3:开发中', '4:待确认', '5:已确认'], sort:"string"},
        { id: 'comfirmer', header: ["确认人",{content:"selectFilter"}], fillspace: 1, editor:"text", sort:"string"} ];
      webix.ui({
        rows:[
            { view:"template", 
              type:"header",
              template: title
            },
            { view:"datatable", 
              id: 'table',
              // autoConfig:true, 
              editable:true,
              columns,
              data,
            },
            {
              view: "button",
              id: 'addRowBtn',
              value: '添加问题/需求',
            }
        ]
      });
      $$('addRowBtn').attachEvent("onItemClick", function(id, e){
        $$("table").add({"status": "1:待处理"});
      });
      $$('table').attachEvent("onDataUpdate", function(id, data){
        const srcData = {title: title, data: $$('table').serialize()};
        window.open(urls[0]+"#"+LZString.compressToEncodedURIComponent(JSON.stringify(srcData)),"_self")
        return true;
      });
    </script>
  </body>
</html>